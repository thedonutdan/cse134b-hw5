<!DOCTYPE html>
<html lang="en-us">
    <head>
        <title>Blog</title>

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Faustina:ital,wght@0,300..800;1,300..800&family=Old+Standard+TT:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

        <link rel="stylesheet" href="/assets/css/main.css">
        <link rel="stylesheet" href="/assets/css/blog.css">
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const toggleBtn = document.getElementById('theme-toggle');
                const currentTheme = localStorage.getItem("theme");
            
                if (currentTheme === "dark") {
                    document.body.classList.add("dark");
                    toggleBtn.textContent = "‚òÄÔ∏è";
                }
            
                toggleBtn.addEventListener("click", () => {
                    document.body.classList.toggle("dark");
                    const isDark = document.body.classList.contains("dark");
                    toggleBtn.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
                    localStorage.setItem("theme", isDark ? "dark" : "light");
                });

                const existing = localStorage.getItem("posts");

                if (!existing) {
                    const defaultPosts = [
                    {
                        title: "Hello World",
                        summary: "An introductory post",
                        url: "post/2025-07-01-hello-world.html",
                        imgsrc: "assets/profile.png"
                    }
                    ];
                    localStorage.setItem("posts", JSON.stringify(defaultPosts));
                    console.log("Default post added to localStorage.");
                }

                fetchFromLocalStorage();

                const loadLocalButton = document.getElementById('load-local');
                const loadCloudButton = document.getElementById('load-cloud');

                loadLocalButton.addEventListener("click", fetchFromLocalStorage);
                loadCloudButton.addEventListener("click", fetchFromCloud);

                class BlogCard extends HTMLElement {
                    connectedCallback() {
                        this.innerHTML = `
                            <h3>${this.getAttribute('title') || 'Blog Post'}</h3>
                            <picture>
                                <img src="${this.getAttribute('imgsrc') || 'assets/profile.png'}"
                                     alt="${this.getAttribute('alt') || 'picture of a handsome man with a mustache'}">
                            </picture>
                            <p>${this.getAttribute('summary') || 'A blog post about something'}</p>
                            <a href="${this.getAttribute('url') || '#'}">View post</a>
                        `;
                    }
                }
                customElements.define('blog-card', BlogCard);

                function fetchFromCloud() {
                    const container = document.getElementById("post-container");
                    container.innerHTML = '';
                    fetch("https://my-json-server.typicode.com/thedonutdan/myjsonserver/posts")
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('HTTP error when fetching');
                            }
                            return response.json();
                        })
                        .then(posts =>{
                            posts.forEach(post => {
                                const card = document.createElement('blog-card');
                                card.setAttribute('title', post.title);
                                card.setAttribute('imgsrc', post.imgsrc);
                                card.setAttribute('summary', post.summary);
                                card.setAttribute('url', post.url);
                                card.setAttribute('class', 'blog-card');
                                container.appendChild(card);
                            });
                        })
                        .catch(error => {
                            console.error("Failed to load posts: ", error);
                        });
                }

                function fetchFromLocalStorage() {
                    const container = document.getElementById("post-container");
                    container.innerHTML = '';
                    const postsRaw = localStorage.getItem("posts");
                    if (postsRaw) {
                        const posts = JSON.parse(postsRaw);
                        posts.forEach(post => {
                                const card = document.createElement('blog-card');
                                card.setAttribute('title', post.title);
                                card.setAttribute('imgsrc', post.imgsrc);
                                card.setAttribute('summary', post.summary);
                                card.setAttribute('url', post.url);
                                card.setAttribute('class', 'blog-card');
                                container.appendChild(card);
                        });
                    }
                }




            });
        </script>
        
    </head>
    <body>
        <header>
            <h1>DevBlog</h1>
            <nav>
                <a href="/index.html">Home</a>
                <a href="/portfolio.html">Portfolio</a>
                <a href="/blog.html">DevBlog</a>
                <a href="/contact.html">Contact</a>
            </nav>
            <button id="theme-toggle" aria-label="Toggle dark mode">üåô</button>
        </header>
        <main>
            <h2>DevBlog Posts</h2>
            <section>
                <button id="load-local">Fetch from local</button>
                <button id="load-cloud">Fetch from cloud</button>
            </section>
                        <search>
                <form>
                    <label for="blogfilter">Filter</label>
                    <select name="blogfilter" id="blogfilter">
                        <optgroup label="Project Type">
                            <option value="">All</option>
                            <option value="algos">Algorithms</option>
                        </optgroup>
                    </select>

                    <label for="blogsearch">Search Projects</label>
                    <input name="blogsearch" id="blogsearch" list="post-options" placeholder="Search Posts">

                    <datalist id="post-options">
                        <option value="genetic-algo-1">Genetic Algorithm</option>
                    </datalist>

                    <button type="submit">Search</button>
                </form>
            </search>
            <section id="post-container">
                <noscript>
                    <p>Unable to retrieve blogposts without JavaScript</p>
                </noscript>
            </section>
        </main>
        <footer>
            <nav>
                <a href="/index.html">Home</a>
                <a href="/contact.html">Contact</a>
            </nav>
        </footer>
</html>